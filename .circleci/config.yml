version: 2
jobs:
  build:
    docker:
      - image: "cimg/node:16.12"
    steps:
      - checkout
      - run:
          name: utilities
          command: |
            sudo npm install -g pnpm
            sudo apt update -y
            sudo apt install libplist-dev libssl-dev openssl qemu-user-binfmt
            sudo mv .circleci/ldid /usr/local/bin
            sudo chmod 555 /usr/local/bin/ldid
      - run:
          name: install
          command: pnpm install -D --frozen-lockfile
      - run:
          name: build
          command: pnpm build
      - run:
          name: package
          command: pnpm pkg
      - run:
          name: release
          command: pnpm semantic-release
